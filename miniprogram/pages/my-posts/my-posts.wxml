<view class="container">
  <!-- Add loading view -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading"></view>
  </view>

  <!-- Only show content when not loading -->
  <block wx:else>
    <!-- 标签切换 -->
    <view class="tab-bar">
      <view class="tab {{activeTab === 'active' ? 'active' : ''}}" bindtap="switchTab" data-tab="active">
        进行中
      </view>
      <view class="tab {{activeTab === 'archived' ? 'active' : ''}}" bindtap="switchTab" data-tab="archived">
        已归档
      </view>
    </view>

    <view class="post-list">
      <post-item 
        wx:for="{{posts}}" 
        wx:key="id"
        post="{{item}}"
        isArchived="{{item.isArchived}}"
        expandedId="{{expandedId}}"
        possibleSeats="{{possibleSeats}}"
        isActive="{{activeTab === 'active'}}"
        deletingPostId="{{deletingPostId}}"
        bind:toggleExpand="toggleExpand"
        bind:updateSeats="updateSeats"
        bind:updateStatus="updateStatus"
        bind:editPost="onEditPost"
        bind:deletePost="onDeletePost"
      />
    </view>

    <view wx:if="{{posts.length === 0}}" class="empty-tip">
      暂无{{activeTab === 'active' ? '进行中' : '已归档'}}的拼车信息
    </view>
  </block>

  <!-- 编辑弹窗组件 -->
  <edit-modal
    showModal="{{showEditModal}}"
    editingPost="{{editingPost}}"
    isSubmitting="{{isSubmittingEdit}}"
    peopleRange="{{peopleRange}}"
    bind:contentInput="onEditContentInput"
    bind:wechatInput="onEditWechatInput"
    bind:timeChange="onEditDepartureTimeChange"
    bind:peopleChange="onEditPeopleChange"
    bind:shareFareChange="onShareFareChange"
    bind:submit="onEditSubmit"
    bind:cancel="onEditCancel"
  />

  <!-- 微信授权弹窗 -->
  <view class="wechat-prompt" wx:if="{{showWechatPrompt}}">
    <view class="wechat-prompt-content">
      <view class="wechat-prompt-header">微信登录</view>
      <view class="wechat-prompt-text">请授权获取微信信息，以便使用拼车功能</view>
      
      <button 
        class="wechat-auth-btn" 
        open-type="getUserInfo" 
        bindgetuserinfo="onGetUserInfo">
        <view class="wechat-icon-text">微信</view>
        微信授权登录
      </button>
    </view>
  </view>
</view> 