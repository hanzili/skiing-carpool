<view class="container">
  <!-- Add loading view -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading"></view>
  </view>

  <!-- Only show content when not loading -->
  <block wx:else>
    <view class="post-list">
      <view 
        wx:for="{{posts}}" 
        wx:key="_id"
        class="post-item"
      >
        <view class="post-content">{{item.content}}</view>
        <view class="post-info">
          <text class="post-time">{{item.createTime}}</text>
          <text class="post-type">{{item.type === 'needCar' ? '人找车' : '车找人'}}</text>
        </view>
        <view class="post-actions">
          <button 
            class="btn-edit"
            size="mini"
            bindtap="onEditPost"
            data-id="{{item._id}}"
            data-content="{{item.content}}"
            data-wechat="{{item.wechat}}"
            data-type="{{item.type}}"
            disabled="{{updatingPostId === item._id || deletingPostId === item._id}}"
          >
            编辑
          </button>
          <button 
            class="btn-status {{item.status === 'completed' ? 'btn-completed' : ''}}"
            size="mini"
            bindtap="onStatusChange"
            data-id="{{item._id}}"
            loading="{{updatingPostId === item._id}}"
            disabled="{{updatingPostId === item._id || deletingPostId === item._id}}"
          >
            {{item.status === 'active' ? '完成行程' : '重新发布'}}
          </button>
          <button 
            class="btn-delete"
            size="mini"
            type="warn"
            bindtap="onDeletePost"
            data-id="{{item._id}}"
            loading="{{deletingPostId === item._id}}"
            disabled="{{updatingPostId === item._id || deletingPostId === item._id}}"
          >
            删除
          </button>
        </view>
      </view>
    </view>

    <view wx:if="{{posts.length === 0}}" class="empty-tip">
      暂无发布信息
    </view>
  </block>

  <!-- 编辑弹窗 -->
  <view class="edit-modal" wx:if="{{showEditModal}}">
    <view class="edit-content">
      <view class="edit-header">编辑信息</view>
      
      <view class="edit-form">
        <view class="form-item">
          <text class="label">拼车信息</text>
          <textarea 
            class="edit-textarea"
            value="{{editingPost.content}}"
            placeholder="请输入拼车信息"
            bindinput="onEditContentInput"
            maxlength="200"
          />
        </view>

        <view class="form-item">
          <text class="label">微信号</text>
          <input 
            class="edit-input"
            value="{{editingPost.wechat}}"
            placeholder="请输入微信号"
            bindinput="onEditWechatInput"
            maxlength="30"
          />
        </view>
      </view>

      <view class="modal-footer">
        <view class="modal-btn" bindtap="onEditCancel">取消</view>
        <view 
          class="modal-btn modal-btn-primary {{isSubmittingEdit ? 'disabled' : ''}}" 
          bindtap="{{!isSubmittingEdit ? 'onEditSubmit' : ''}}"
        >
          {{isSubmittingEdit ? '保存中...' : '保存'}}
        </view>
      </view>
    </view>
  </view>
</view> 